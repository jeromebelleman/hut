#! /usr/bin/env python
# Irina Grigorescu 
# irina.grigorescu@cern.ch
# Jerome Belleman
# jerome.belleman@gmail.com

'''
A Kibana dashboard template tool
'''

import os
import sys
import argparse
import json

from mako.template import Template

def main():
    '''
    Main function
    '''

    # Check Arguments
    parser = argparse.ArgumentParser(description="A dashboard template tool.")
    parser.add_argument('directory', help="dashboard template directory")
    parser.add_argument('output', help="output file")
    args = parser.parse_args()
        
    try:
        # Load JSON template
        template = Template(filename=args.directory + '/template.json')

        # Create output file
        with open(args.output, 'w') as fhl:
            cwd = os.getcwd()
            os.chdir(args.directory)
            fhl.write(template.render())
            os.chdir(cwd)

        # Check JSON validity
        with open(args.output, 'r') as fhl:
            json.load(fhl)

    except (IOError, ValueError), exc:
        print >> sys.stderr, exc
        return 1

if __name__ == '__main__':
    sys.exit(main())
